## QA List
- [ ] 開發環境與 AVD 檢查（WindSurf / VS Code 架構，不安裝 Android Studio）
  - [x] 在終端執行 `java -version` 應為 JDK 17；`echo $JAVA_HOME` 指向 JDK 17
  - [x] 在終端執行 `sdkmanager --list` 能列出已安裝的 platform-tools / platforms;android-35 / build-tools;35.0.0
  - [x] 以 `avdmanager list avd` 確認 `Pixel6PlayApi35` 已建立
  - [x] 啟動 `emulator -avd Pixel6PlayApi35`，確認可安裝與啟動基本 APK
  - [x] 在 WindSurf 內能跑 `./gradlew assembleDebug` 並看到成功輸出 `app/build/outputs/`
- [ ] 首次啟動（模型資產解壓與校驗）
  - [x] 安裝 debug APK 後首次開啟 App，觀察 logcat：應出現「models.zip 解壓 → files/models/」成功紀錄
  - [x] 觀察 logcat：應執行 SHA-256 驗證並輸出 `validateModelChecksum=true`
  - [ ] 若校驗失敗（刻意改動 .onnx 檔），App 應阻擋推理並彈出錯誤提示（重新下載或重建資產）
- [ ] Onboarding（同意條款與隱私、首次引導）
  - [ ] 勾選同意→可進入主畫面；未勾選→無法繼續且顯示政策連結
  - [ ] 切換語言（繁中 / 英文占位）後 UI 字串即時更新
  - [ ] 關閉 Onboarding 後重開 App 不再顯示（設定頁可重置旗標再檢查）
- [ ] 主畫面（HomeScreen）
  - [ ] 顯示四區：快速排盤 / 工具選單 / 我的報告 / 每日黃曆卡
  - [ ] 點「快速排盤」→導向 `ChartInputScreen(kind=上次使用類型)`
  - [ ] 工具選單包含：八字、紫微、西洋星盤、天賦設計圖、易經/卦象、黃曆/農民曆、N+1 綜合分析入口
  - [ ] 我的報告區顯示最近 5 筆報告；可點進詳細
  - [ ] 每日黃曆卡顯示今日農曆、節氣、宜忌摘要
- [ ] 輸入頁（ChartInputScreen）
  - [ ] 日期選擇器可選西元日期；時間可選 24h；可清空未知出生時
  - [ ] 時區：可自動帶出預設（系統），亦可手動選擇
  - [ ] 地點：提供城市選單/手動輸入；未填地點時仍可進行八字/紫微
  - [ ] 填完→按「產生命盤」導向對應結果頁；未填必要欄位則阻止提交並提示
- [ ] 八字引擎（:core:lunar / :features:bazi）
  - [ ] 輸入生日（含節氣交界日）產生四柱正確（跨 UTC/台北時區邊界）
  - [ ] 顯示十神、五行比例（條圖/分數）與日主強弱標示
  - [ ] 歲運/大運基本列表正確（以節氣換歲）；切換虛歲/實歲選項數據同步更新
  - [ ] 重新進入同一筆輸入→結果一致；儲存到 `ChartEntity` 與 `ReportEntity` 之 summary 字段
- [ ] 紫微斗數引擎（:features:ziwei）
  - [ ] 依生辰顯示十二宮宮格，星曜落宮與四化標示清楚
  - [ ] 點擊任一宮/星曜→彈出自撰解釋卡片；返回不影響捲動位置
  - [ ] 切換樣式（深色/淺色）命盤可讀性良好；字體放大不溢位
  - [ ] 相同輸入重算結果一致；儲存快照 JSON 於 `ChartEntity.computedJson`
- [ ] 西洋星盤引擎（:core:astro / :features:astrochart）
  - [ ] 輸入含地點與時區→生成本命盤圓盤、12 宮、行星點位
  - [ ] 相位表（0/60/90/120/180，容許 6°）正確，與參考固定日期比對
  - [ ] 切換 House system（Whole Sign / Porphyry 如有）相位/落宮同步更新
  - [ ] 放大/縮小/平移圓盤流暢；點擊行星顯示詳細度數/落宮
- [ ] 天賦設計圖（人類圖支援；:features:design）
  - [ ] 以行星黃經→映射至 64 閘門；BodyGraph 矢量圖載入快速
  - [ ] 點擊中心/通道顯示說明（自撰文本，避免侵權用語）
  - [ ] 類型/權威/策略推論與摘要卡一致；切換語言後文案同步更新
- [ ] 易經/卦象（簡版）
  - [ ] 依當前時間起卦→生成卦象；顯示卦名/卦辭摘要
  - [ ] 釋義為自撰/公版改寫；同時顯示提醒：僅供參考
  - [ ] 重新起卦（不同時間）→卦象可變；結果可儲存成報告
- [ ] 黃曆/農民曆/生肖
  - [ ] 今日卡顯示農曆日期、節氣、宜/忌；跨日檢查是否自動刷新
  - [ ] 生肖運勢列表與年份生肖對應正確；切換年分資料同步
- [ ] N+1 綜合分析（:features:mix-ai）
  - [ ] 從多個已產生的命盤摘要（八字/紫微/星盤/設計圖/卦象/黃曆）合流
  - [ ] 點「生成 AI 詳解」→顯示付費牆（若尚未解鎖）或直接排程背景任務
  - [ ] 生成完成通知出現；點通知深連結開啟 `ReportScreen(reportId)`
  - [ ] 報告包含：關鍵特質、四象限（事業/情感/健康/財務）機會與風險、3~5 條具體建議、決策陷阱提醒
- [ ] AI 子系統（ONNX Runtime；:core:ai）
  - [ ] 以固定 Prompt 與種子產生輸出可重現（長度在 700~1200 tokens）
  - [ ] `OnnxAiEngine.generateStreaming()` 持續流出片段→UI 逐段顯示
  - [ ] 中斷網路不影響本機推理；推理期間切至背景不終止
  - [ ] Tokenizer encode/decode 基本案例（中/英/符號）往返一致
- [ ] 背景運算與通知（WorkManager + Foreground）
  - [ ] 在結果頁按「生成 AI 詳解」→建立 `OneTimeWorkRequest` 成功
  - [ ] 模擬長任務：超過門檻自動升級為前景服務並顯示常駐通知
  - [ ] 滑掉 App / 鎖屏 5 分鐘後回來→任務仍在進行或已完成
  - [ ] 任務完成→系統通知；點擊通知開啟對應報告頁（深連結正確）
- [ ] 結果頁（ReportScreen）
  - [ ] 生成中顯示進度條（星塵動效）；>80% 時切換成功色
  - [ ] 可調章節數（6/8/10/12）；輸出自動分段，章節標題對齊
  - [ ] 支援收藏、分享（純文字/圖片導出如未提供則隱藏）
  - [ ] 未解鎖權益之功能（推送/拉取/分享）顯示禁用狀態與引導
- [ ] 資料層（Room / DataStore）
  - [ ] 建立/更新 `ReportEntity/ChartEntity/WalletEntity/PurchaseEntity/UserProfileEntity` 正常
  - [ ] `ReportDao.listRecent(limit)` 返回排序正確；`search(keyword)` 可模糊搜索標題/摘要
  - [ ] DataStore 偏好（語言/主題/通知/同步）讀寫正確，App 重啟設定保留
  - [ ] 備份與還原：啟用 Auto Backup 後，在 AVD 移除/重裝 App →資料（非排除清單）自動回復
- [ ] 加密與安全（androidx.security.crypto）
  - [ ] 首次啟動建立金鑰成功；旋轉金鑰（如設計）不破壞既有資料
  - [ ] `ReportEntity.contentEnc`、`WalletEntity` 關鍵欄位加密存放；資料庫檔案外觀非明文
  - [ ] 嘗試以 root 檔案檢視器讀取 DB：敏感欄位不可讀（密文）
- [ ] UI/UX 與無障礙
  - [ ] 全域深/淺色切換即時；對比度達標；字體放大 130% 不崩版
  - [ ] 所有互動元素具 `contentDescription`；TalkBack 能朗讀關鍵內容
  - [ ] 主要流程（輸入→摘要→生成→通知→查看）的點擊數 ≤ 預期；導航返回行為符合直覺
  - [ ] 錯誤/空狀態頁：離線/無輸入/計算失敗顯示清楚且具重試入口
- [ ] 效能與穩定
  - [ ] 冷啟動 < 2.5s；首頁首屏 FMP 在 1.5s 內（AVD 近似中階裝置）
  - [ ] 生成 700/900/1200 tokens 三檔用時與 CPU 溫度記錄在案；不超過可接受上限
  - [ ] 連續生成 3 次不崩潰；ANR < 閾值；記憶體峰值無 OOM
  - [ ] 飛航模式/弱網路：本機功能可用；雲端相關功能適當提示但不影響離線核心
- [ ] 錯誤日誌與匿名診斷（選用）
  - [ ] 本地錯誤寫入 `files/logs/app.log` 成功；滾動切割檔案不超出上限
  - [ ] 使用者在設定開啟「匿名診斷」→允許將裁剪後日誌上傳至 Drive App Folder
  - [ ] 關閉該選項→不再嘗試上傳；離線時不阻斷主流程
- [ ] 多語與在地化
  - [ ] `values-zh-rTW` 與 `values-en` 字串覆蓋完整；未翻譯鍵不出現 placeholder
  - [ ] 語言切換對所有模組頁生效（含付費牆、錯誤文案、提示）
  - [ ] 黃曆/曆法日期在英文語系仍維持正確格式（必要中文名詞保留）
- [ ] 相容性測試（AVD）
  - [ ] API 26 / 28 / 30 / 34 各一台 AVD 跑通主要流程
  - [ ] 通知權限（Android 13+）彈窗與引導正確；拒絕後仍能在設定頁開啟
  - [ ] 前景服務權限正確；長任務不被系統回收
- [ ] 付費牆與權益（不進行購買流程，只驗觀感與邏輯）
  - [ ] Paywall 顯示 SKU 卡片與功能對應；已解鎖功能標記「已擁有」
  - [ ] 權益檢查：未擁有 VIP 時，分享/同步/高級報告入口顯示解鎖引導
  - [ ] 「恢復購買」按鈕存在且能正常觸發查詢（最終購買測於最後階段）
- [ ] ASO 與素材（靜態檢查）
  - [ ] App 名稱/短描述/長描述關鍵字密度是否符合策略；避免敏感商標詞
  - [ ] 6 張截圖與 Icon 為自製向量；風格一致；截圖文案雙語一致
  - [ ] 隱私政策 URL 可正確開啟；條款與聯絡頁有效
- [ ] 上架前清單（Play Console 靜態項）
  - [ ] Data Safety 問卷與實際行為一致（收集/用途/加密/用戶控制/第三方 SDK）
  - [ ] 內容分級問卷為一般用戶；如有廣告需勾選「含廣告」
  - [ ] 64-bit 要求符合；targetSdk/compileSdk=35；簽章與 .aab 可驗
  - [ ] Internal 測試軌準備就緒（僅靜態配置，不上傳購買測試版）
- [ ] 內購/訂閱（最後一輪測試；需 Play Console 與測試帳號）
  - [ ] 建 SKU：`iap_bazi_pro` / `iap_ziwei_pro` / `iap_design_pro` / `iap_astro_pro`、`sub_vip_month` / `sub_vip_year`
  - [ ] `BillingManager.startConnection()` 成功；查詢 `queryProducts()` 能返回所有 SKU
  - [ ] 用測試帳購買一次性內購→`handlePurchase()` 認列權益並 `acknowledgePurchase` 成功
  - [ ] 用測試帳購買訂閱→權益即時生效；取消訂閱後寬限期/過期狀態正確
  - [ ] 重新安裝/換機→「恢復購買」可取回權益；同步至 Wallet/Drive（在雲端測試段一起驗）
- [ ] 激勵廣告（最後一輪測試）
  - [ ] `RewardedAdsManager.loadRewardedAd()` 能載入測試廣告；失敗有錯誤碼與重試
  - [ ] 成功觀看一次→`onUserEarnedReward` 觸發 `WalletRepository.earnCoins(+10)`
  - [ ] 設定冷卻與每日上限生效；達上限後 UI 顯示不可觀看狀態
  - [ ] 以 5 次廣告累積 50 幣→可兌換一次 N+1 詳解；扣幣後餘額正確
- [ ] 雲端同步（Google Sign-In + Drive App Folder）（最後一輪測試）
  - [ ] 首次登入彈出同意畫面；授權 `drive.appdata` 成功
  - [ ] `SyncManager.syncUp()`：上傳 `reports.json / wallet.json / purchases.json` 成功（加密後）
  - [ ] `SyncManager.syncDown()`：清除本機後下載回來資料與 updatedAt 合併策略正確
  - [ ] 登出→本機資料保留；關閉同步→不再嘗試背景上傳
  - [ ] 換機測試：在第二台 AVD 登入同帳→自動下載與購買恢復一致
- [ ] 最後 48 小時總驗（合規/封版）
  - [ ] 名稱/描述/截圖/影片/隱私 URL 一致且有效
  - [ ] `.aab` 簽章可驗與安裝測試可啟動
  - [ ] 內購/訂閱購買與恢復流程通過；激勵廣告/點數兌換通過
  - [ ] 同步開關與換機流程通過；背景運算與通知在 Android 13/14/15 通過
  - [ ] 商標/授權/第三方 LICENSE 清單完成；Data Safety / 分級 / 廣告宣告與實際一致